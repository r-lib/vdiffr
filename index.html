<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Visual Regression Testing and Graphical Diffing • vdiffr</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet">
<link href="deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Visual Regression Testing and Graphical Diffing">
<meta name="description" content="An extension to the testthat package that makes it easy to add graphical unit tests. It provides a Shiny application to manage the test cases.">
<meta property="og:description" content="An extension to the testthat package that makes it easy to add graphical unit tests. It provides a Shiny application to manage the test cases.">
<script defer data-domain="vdiffr.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">vdiffr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.7.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2021/06/vdiffr-1-0-0/">Version 1.0.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/01/vdiffr-0-3-0/">Version 0.3.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-lib/vdiffr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="vdiffr">vdiffr<a class="anchor" aria-label="anchor" href="#vdiffr"></a>
</h1></div>
<!-- badges: start -->

<p>vdiffr is a testthat extension for monitoring the appearance of R plots. It generates reproducible SVG files and registers them as the <a href="https://testthat.r-lib.org/articles/snapshotting.html" class="external-link">testthat snapshots</a>.</p>
<div class="section level2">
<h2 id="how-to-use-vdiffr">How to use vdiffr<a class="anchor" aria-label="anchor" href="#how-to-use-vdiffr"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>Add graphical expectations by including <code><a href="reference/expect_doppelganger.html">expect_doppelganger()</a></code> in your test files.</p></li>
<li><p>Run <code>devtools::test()</code>.</p></li>
<li><p>If <code>test()</code> detected new snapshots or changes to existing snapshots, run <code><a href="https://testthat.r-lib.org/reference/snapshot_accept.html" class="external-link">testthat::snapshot_review()</a></code> to review them.</p></li>
</ol>
<p>There may be many reasons for a snapshot to fail. Upstream changes (e.g. to the R graphics engine or to ggplot2) may cause subtle differences in your plots that are not actual failures. For this reason, snapshots do not cause failures on CRAN by default. You will only see failures locally or on CI platforms such as Github Actions.</p>
<div class="section level3">
<h3 id="adding-expectations">Adding expectations<a class="anchor" aria-label="anchor" href="#adding-expectations"></a>
</h3>
<p>vdiffr integrates with testthat through the <code><a href="reference/expect_doppelganger.html">expect_doppelganger()</a></code> expectation. It takes as arguments:</p>
<ul>
<li><p>A title. This title is used in two ways. First, the title is standardised (it is converted to lowercase and any character that is not alphanumeric or a space is turned into a dash) and used as filename for storing the figure. Secondly, with ggplot2 figures the title is automatically added to the plot with <code>ggtitle()</code> (only if no ggtitle has been set).</p></li>
<li><p>A figure. This can be a ggplot object, a recordedplot, a function to be called, or more generally any object with a <code>print</code> method.</p></li>
</ul>
<p>The snapshots are recorded in subfolders of the <code>_snaps/</code> directory.</p>
<p>```{r} disp_hist_base &lt;- function() hist(mtcars$disp) disp_hist_ggplot &lt;- ggplot(mtcars, aes(disp)) + geom_histogram()</p>
<p>vdiffr::expect_doppelganger(“Base graphics histogram”, disp_hist_base) vdiffr::expect_doppelganger(“ggplot2 histogram”, disp_hist_ggplot) ```</p>
<p>Note that in addition to automatic ggtitles, ggplot2 figures are assigned the minimalistic theme <code>theme_test()</code> (unless they already have been assigned a theme).</p>
</div>
<div class="section level3">
<h3 id="debugging">Debugging<a class="anchor" aria-label="anchor" href="#debugging"></a>
</h3>
<p>It is sometimes difficult to understand the cause of a doppelganger failure. A frequent cause of failure is undeterministic generation of plots. Potential culprits are:</p>
<ul>
<li><p>Some of the plot components depend on random variation. Try setting a seed.</p></li>
<li><p>The plot depends on some system library. For instance sf plots depend on libraries like GEOS and GDAL. It might not be possible to test these plots with vdiffr (which can still be used for manual inspection, add a [testthat::skip()] before the <code><a href="reference/expect_doppelganger.html">expect_doppelganger()</a></code> call in that case).</p></li>
</ul>
<p>To help you understand the causes of a failure, vdiffr automatically logs the SVG diff of all failures when run under R CMD check. The log is located in <code>tests/vdiffr.Rout.fail</code> and should be displayed on Travis.</p>
<p>You can also set the <code>VDIFFR_LOG_PATH</code> environment variable with <code><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv()</a></code> to unconditionally (also interactively) log failures in the file pointed by the variable.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=vdiffr" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/r-lib/vdiffr/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/r-lib/vdiffr/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing vdiffr</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://github.com/lionel-" class="external-link">Lionel Henry</a> <br><small class="roles"> Maintainer, author </small>  </li>
<li>
<a href="https://data-imaginist.com" class="external-link">Thomas Lin Pedersen</a> <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-5147-4711" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>
<a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a> <br><small class="roles"> Copyright holder, funder </small>  </li>
<li>T Jake Luciani <br><small class="roles"> Author </small>  </li>
<li>Matthieu Decorde <br><small class="roles"> Author </small>  </li>
<li>Vaudor Lise <br><small class="roles"> Author </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=vdiffr" class="external-link"><img src="https://www.r-pkg.org/badges/version/vdiffr" alt="CRAN status"></a></li>
<li><a href="https://github.com/r-lib/vdiffr/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/r-lib/vdiffr/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://app.codecov.io/gh/r-lib/vdiffr" class="external-link"><img src="https://codecov.io/gh/r-lib/vdiffr/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>

  </aside>
</div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/lionel-" class="external-link">Lionel Henry</a>, <a href="https://data-imaginist.com" class="external-link">Thomas Lin Pedersen</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>, T Jake Luciani, Matthieu Decorde, Vaudor Lise.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer>
</body>
</html>
