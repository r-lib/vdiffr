<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Does a figure look like its expected output? — expect_doppelganger • vdiffr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Does a figure look like its expected output? — expect_doppelganger"><meta name="description" content="expect_doppelganger() is a testthat expectation for graphical
plots. It generates SVG snapshots that you can review graphically
with testthat::snapshot_review(). You will find more information
about snapshotting in the testthat snapshots vignette.
Note that expect_doppelgagner() requires R version 4.1.0. If run
on an earlier version of R, it emits a testthat::skip() so that you
can still run other checks on old versions of R."><meta property="og:description" content="expect_doppelganger() is a testthat expectation for graphical
plots. It generates SVG snapshots that you can review graphically
with testthat::snapshot_review(). You will find more information
about snapshotting in the testthat snapshots vignette.
Note that expect_doppelgagner() requires R version 4.1.0. If run
on an earlier version of R, it emits a testthat::skip() so that you
can still run other checks on old versions of R."><script defer data-domain="vdiffr.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">vdiffr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.7.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news"><li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2021/06/vdiffr-1-0-0/">Version 1.0.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/01/vdiffr-0-3-0/">Version 0.3.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-lib/vdiffr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Does a figure look like its expected output?</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-lib/vdiffr/blob/main/R/expect-doppelganger.R" class="external-link"><code>R/expect-doppelganger.R</code></a></small>
      <div class="d-none name"><code>expect_doppelganger.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>expect_doppelganger()</code> is a testthat expectation for graphical
plots. It generates SVG snapshots that you can review graphically
with <code><a href="https://testthat.r-lib.org/reference/snapshot_accept.html" class="external-link">testthat::snapshot_review()</a></code>. You will find more information
about snapshotting in the <a href="https://testthat.r-lib.org/articles/snapshotting.html" class="external-link">testthat snapshots vignette</a>.</p>
<p>Note that <code>expect_doppelgagner()</code> requires R version 4.1.0. If run
on an earlier version of R, it emits a <code><a href="https://testthat.r-lib.org/reference/skip.html" class="external-link">testthat::skip()</a></code> so that you
can still run other checks on old versions of R.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">expect_doppelganger</span><span class="op">(</span></span>
<span>  <span class="va">title</span>,</span>
<span>  <span class="va">fig</span>,</span>
<span>  path <span class="op">=</span> <span class="fu">deprecated</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  writer <span class="op">=</span> <span class="va">write_svg</span>,</span>
<span>  cran <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  variant <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-title">title<a class="anchor" aria-label="anchor" href="#arg-title"></a></dt>
<dd><p>A brief description of what is being tested in the
figure. For instance: "Points and lines overlap".</p>
<p>If a ggplot2 figure doesn't have a title already, <code>title</code> is
applied to the figure with <code><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle()</a></code>.</p>
<p>The title is also used as file name for storing SVG (in a
sanitzed form, with special characters converted to <code>"-"</code>).</p></dd>


<dt id="arg-fig">fig<a class="anchor" aria-label="anchor" href="#arg-fig"></a></dt>
<dd><p>A figure to test. This can be a ggplot object, a
recordedplot, or more generally any object with a <code>print</code> method.</p>
<p>If you need to test a plot with non-printable objects (e.g. base
plots), <code>fig</code> can be a function that generates and prints the
plot, e.g. <code>fig = function() plot(1:3)</code>.</p></dd>


<dt id="arg-path-">path, ...<a class="anchor" aria-label="anchor" href="#arg-path-"></a></dt>
<dd><p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated" class="external-link"><img src="figures/lifecycle-deprecated.svg" alt="[Deprecated]"></a>.</p></dd>


<dt id="arg-writer">writer<a class="anchor" aria-label="anchor" href="#arg-writer"></a></dt>
<dd><p>A function that takes the plot, a target SVG file,
and an optional plot title. It should transform the plot to SVG
in a deterministic way and write it to the target file. See
<code><a href="write_svg.html">write_svg()</a></code> (the default) for an example.</p></dd>


<dt id="arg-cran">cran<a class="anchor" aria-label="anchor" href="#arg-cran"></a></dt>
<dd><p>If <code>FALSE</code> (the default), mismatched snapshots only
cause a failure when you run tests locally or in your CI (Github
Actions or any platform that sets the <code>CI</code> environment variable).
If <code>TRUE</code>, failures may also occur on CRAN machines.</p>
<p>Failures are disabled on CRAN by default because testing the
appearance of a figure is inherently fragile. Changes in the R
graphics engine or in ggplot2 may cause subtle differences in the
aspect of a plot, such as a slightly smaller or larger margin.
These changes will cause spurious failures because you need to
update your snapshots to reflect the upstream changes.</p>
<p>It would be distracting for both you and the CRAN maintainers if
such changes systematically caused failures on CRAN. This is why
snapshot expectations do not fail on CRAN by default and should
be treated as a monitoring tool that allows you to quickly check
how the appearance of your figures changes over time, and to
manually assess whether changes reflect actual problems in your
package.</p>
<p>Internally, this argument is passed to
<code><a href="https://testthat.r-lib.org/reference/expect_snapshot_file.html" class="external-link">testthat::expect_snapshot_file()</a></code>.</p></dd>


<dt id="arg-variant">variant<a class="anchor" aria-label="anchor" href="#arg-variant"></a></dt>
<dd><p>If not-<code>NULL</code>, results will be saved in
<code>_snaps/{variant}/{test}/{name}.{ext}</code>. This allows you to create
different snapshots for different scenarios, like different operating
systems or different R versions.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="debugging">Debugging<a class="anchor" aria-label="anchor" href="#debugging"></a></h2>


<p>It is sometimes difficult to understand the cause of a failure.
This usually indicates that the plot is not created
deterministically. Potential culprits are:</p><ul><li><p>Some of the plot components depend on random variation. Try
setting a seed.</p></li>
<li><p>The plot depends on some system library. For instance sf plots
depend on libraries like GEOS and GDAL. It might not be possible
to test these plots with vdiffr.</p></li>
</ul><p>To help you understand the causes of a failure, vdiffr
automatically logs the SVG diff of all failures when run under R
CMD check. The log is located in <code>tests/vdiffr.Rout.fail</code> and
should be displayed on Travis.</p>
<p>You can also set the <code>VDIFFR_LOG_PATH</code> environment variable with
<code><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv()</a></code> to unconditionally (also interactively) log failures
in the file pointed by the variable.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span>  <span class="co"># Not run</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">test_that</span><span class="op">(</span><span class="st">"plots have known output"</span>, <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">disp_hist_base</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">disp</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu">expect_doppelganger</span><span class="op">(</span><span class="st">"disp-histogram-base"</span>, <span class="va">disp_hist_base</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">disp_hist_ggplot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">disp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu">expect_doppelganger</span><span class="op">(</span><span class="st">"disp-histogram-ggplot"</span>, <span class="va">disp_hist_ggplot</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/lionel-" class="external-link">Lionel Henry</a>, <a href="https://data-imaginist.com" class="external-link">Thomas Lin Pedersen</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>, T Jake Luciani, Matthieu Decorde, Vaudor Lise.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer></body></html>

